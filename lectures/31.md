6.2 Queuing Disciplines
=======================

Routers
-------

- Maintain queues of packets to be forwarded
- The design and use of these queues is a queuing discipline

FIFO
----

- First-in, first-out
- Packets are forwarded in the order they arrive

---

![FIFO Example](https://book.systemsapproach.org/_images/f06-05-9780123850591.png){height=540px}

Fairness
--------

- FIFO allocates packets based on arrival
- A host sending a lot of data will dominate the link
- Hosts sending little data will experience high latency

Fair Queuing
-------------

- Use buffers for each flow
- Send packets in FIFO order per flow in round-robin fashion

---

![Round-robin service](https://book.systemsapproach.org/_images/f06-06-9780123850591.png)

Packet Sizes
------------

- Packets may be different sizes
- We must account for this in order to ensure fairness
- This makes the simple round-robin example a bit more complicated

---

![Queuing in action](https://book.systemsapproach.org/_images/f06-07-9780123850591.png)

Properties
----------

1. *Work conserving* - The link will be active as long as there is a packet in the queue
2. Flows may use only 1/n of the link bandwidth when the link is full

Weighted Fair Queuing
---------------------

- We can assign weights to flows to give them more or less bandwidth
- Weights can be determined in various ways (hosts, traffic type, etc)
- Weights can ultimately be used to shape traffic and provide differing quality of service

6.3 TCP Congestion Control
==========================

Overview
--------

- CongestionWindow is managed by sender to limit packets in flight and transmission speed

Congestion Window
-----------------

- Set based on perceived network congestion
- Packet timeouts are used to adjust window size
- Additive Increase/Multiplicative Decrease

---

![Additive Increase](https://book.systemsapproach.org/_images/f06-08-9780123850591.png){height=540px}

Window Adjustment
-----------------

- Halve window size on each timeout
- Add 1 to window size on each successful round trip
- In practice, window size is increased by a small fraction of MSS for each ACK

---

![Sawtooth Congestion Window over time](https://book.systemsapproach.org/_images/f06-09-9780123850591.png)

Slow Start
----------

- TCP originally sent as many packets as the advertised window would allow when starting connections
- This caused congestion issues, and the behavior was changed to double the congestion window on each ACK at the start of a connection
- Slow start is also used when the connection is dead after waiting for a timeout

---

![TCP Slow Start](https://book.systemsapproach.org/_images/f06-10-9780123850591.png){height=540px}

---

![Windows Size and Slow Start](https://book.systemsapproach.org/_images/f06-11-9780123850591.png)

Fast Retransmit
---------------

- Ordinarily, we wait for a coarse-grained timeout before sending a packet
- We can implement an algorithm that performs more effectively by using knowledge of our link
- By listening for duplicate ACKs, we can deduce lost packets and retransmit them

---

![Fast retransmit based on duplicate ACKs](https://book.systemsapproach.org/_images/f06-12-9780123850591.png){height=540px}

TCP CUBIC
---------

- Alternative congestion window management algorithm
- Default algorithm used by Linux

Max Window Size
---------------

- TCP CUBIC tracks the largest congestion window it was able to use successfully before experiencing congestion
- After a congestion event, CUBIC attempts to return to this window size at a cubic rate
- It approaches slowly, plateaus for, and then attempts to probe for a larger max window

---

![TCP CUBIC congestion window adjustment](https://book.systemsapproach.org/_images/Slide11.png)
