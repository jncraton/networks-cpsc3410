8 Network Security
==================

---

- [Stealing a Tesla using Bluetooth](https://www.youtube.com/watch?v=clrNuBb3myE)
- [Details](https://www.wired.com/story/tesla-model-x-hack-bluetooth/)

Threats
-------

- Our systems are designed with trust and threats in mind
- There are usually trade-offs to be made to prevent certain threats on our systems

Encryption
----------

- A function is applied to a *plaintext* message to create a *ciphertext*
- The ciphertext can be read by anyone, but it should only be able to be converted back to the plaintext by the intended parties
- Receivers apply a decryption function to convert the ciphertext back to the plaintext

Secret Key Ciphers
------------------

- Both parties must possess the same secret key
- Examples include DES, Blowfish, and AES
- Solves the encryption problem, but creates a key distribution problem

---

![Secret Key Encryption](https://book.systemsapproach.org/_images/f08-01-9780123850591.png)

Example
-------

Encryption

```sh
openssl enc -aes-256-cbc -out {file}
```

Decryption

```sh
openssl enc -d -aes-256-cbc -in {file}
```

Public-Key Ciphers
------------------

- Address key distribution issues
- Use a private key for decryption, but a public key can be shared with others that is used to create a ciphertext
- Examples in RSA and Elliptic-curve cryptography (ECC)

---

![Public Key Encryption](https://book.systemsapproach.org/_images/f08-03-9780123850591.png){height=540px}

Public key Authentication
-------------------------

- A private key can also be used to encrypt messages
- These messages can be decrypted using the public key
- This provides no security, but ensures that the sender holds the private key

---

![Public Key Authentication](https://book.systemsapproach.org/_images/f08-04-9780123850591.png)

Authenticator
-------------

- Value included with a message to verify that it has not been tampered with and contains no errors
- Commonly a hashed message authentication code (HMAC)
- HMAC hashes a known secret value appended to the plaintext

---

![MAC and HMAC](https://book.systemsapproach.org/_images/f08-05-9780123850591.png)

Example Systems
---------------

SSH
---

- Modern and secure remote access protocol replacing telnet
- Built over TCP adding encryption (often AES)
- Public keys of servers are sent on first connection and stored locally
- Passwords or private keys are used for user authentication

---

![SSH Port Forwarding](https://book.systemsapproach.org/_images/f08-14-9780123850591.png)

Transport Layer Security
------------------------

- TLS builds on TCP to create an encrypted transport stream
- Handshake negotiates protocols to use
- Secret key is exchanged

---

![TLS in Network Stack](https://book.systemsapproach.org/_images/f08-15-9780123850591.png)

---

![TLS Handshake](https://book.systemsapproach.org/_images/f08-16-9780123850591.png){height=540px}

Certificate Authority
---------------------

- Provide public key certificates
- Ensures that user is connecting to the system they are expecting to connect to
- Certificates can be purchased, but some services offer free certificates

TLS Benefits
------------

- Encryption - Messages can't be viewed by others
- Authentication - Messages can't be tampered with

Firewall
--------

- Sit between a local network and the outside world blocking unauthorized traffic

Intrusion Detection System
--------------------------

- Monitors the local network for anomalous behavior
- Alerts network administrators to possible threats and attacks

9.1 Traditional Applications
============================

World Wide Web
--------------

- The World Wide Web is not the Internet
- The Internet is a global network of networks connecting most modern computing systems
- The World Wide Web is a set of interconnected hypertext documents

Hypertext
---------

Documents with links to other documents that are immediately accessible

Uniform Resource Identifier (URI)
---------------------------------

- A string used to concretely identify a document, image, service, or other resource
- The web commonly uses a specific type of URI called a URL

URL
---

- Includes identification and access mechanism
- Example: https://en.wikipedia.org/wiki/URL

Hypertext Transfer Protocol (HTTP)
----------------------------------

- Used initially to transmit hypertext documents on the web
- Combines URI with verbs to perform operations

---

+-----------+-----------------------------------------------------------+
| Operation | Description                                               |
+===========+===========================================================+
| GET       | Retrieve document identified in URL                       |
+-----------+-----------------------------------------------------------+
| POST      | Give information (e.g., annotation) to server             |
+-----------+-----------------------------------------------------------+
| PUT       | Store document under specified URL                        |
+-----------+-----------------------------------------------------------+
| DELETE    | Delete specified URL                                      |
+-----------+-----------------------------------------------------------+

Simple HTTP Request
-------------------

Requests the root document from a host.

```
GET / HTTP/1.1
```

Simple HTTP Response
--------------------

Indicates that the document is not available.

```
HTTP/1.1 404 Not Found
```

---

+------+---------------+--------------------------------------------------------+
| Code | Type          | Example Reasons                                        |
+======+===============+========================================================+
| 1xx  | Informational | request received, continuing process                   |
+------+---------------+--------------------------------------------------------+
| 2xx  | Success       | action successfully received, understood, and accepted |
+------+---------------+--------------------------------------------------------+
| 3xx  | Redirection   | further action must be taken to complete the request   |
+------+---------------+--------------------------------------------------------+
| 4xx  | Client Error  | request contains bad syntax or cannot be fulfilled     |
+------+---------------+--------------------------------------------------------+
| 5xx  | Server Error  | server failed to fulfill an apparently valid request   |
+------+---------------+--------------------------------------------------------+

TCP Connections
---------------

- HTTP is built on top of TCP
- It's usage has evolved between 1.0, 1.1 and 2.0
- HTTP/3 uses QUIC

---

![HTTP/1.0 Connections](https://book.systemsapproach.org/_images/f09-04-9780123850591.png){height=540px}

---

![HTTP/1.1 Connections](https://book.systemsapproach.org/_images/f09-05-9780123850591.png)

Caching
-------

- We can improve latency and reduce bandwidth by storing resources that we've already used
- Most browser will manage a cache of previously seen resources and not request them again until they expire
- Proxy and reverse proxy servers can also be used for caching purposes

---

![Reverse proxy](https://upload.wikimedia.org/wikipedia/commons/6/67/Reverse_proxy_h2g2bob.svg)

Web Services
------------

- We can use use HTTP to build web services to perform tasks and not merely deliver static documents
- Many standard (WSDL, SOAP) and non-standard mechanisms are used to build interfaces to web services
- Many services build a new protocol on top of HTTP

Representational State Transfer (REST)
--------------------------------------

- Uses standard HTTP verbs to interact with a service at a URL
- Uses custom media types to represent datagrams
- Stateless protocol that does not require the server to maintain per-session state

9.3 Infrastructure Applications
===============================

Name Service (DNS)
------------------

Addressing
----------

- IP addresses are used to identify hosts
- They aren't user friendly
- They can change as networks change

Name services
-------------

- Middleware to fill gap between application and network
- Convert human-readable names to addresses

Namespace
---------

- Set of possible names
- Flat namespaces
- Hierarchical namespaces

Resolution Mechanism
--------------------

- Returns the value bindings for a particular name
- Often, this will addresses returned by a *name server*

Early Implementation
--------------------

- When the Internet was small, all hosts managed a mapping of names to addresses
- This can still be found in /etc/hosts on most systems
- Name lookups were performed against this local table

Name servers
------------

- Used to perform name lookups in modern systems
- Track and cache global name mappings

---

![Name lookup process](https://book.systemsapproach.org/_images/f09-14-9780123850591.png)

Domain Hierarchy
----------------

- Modern names are broken into domains
- Name servers then service the part of the hierarchy they are responsible for

---

![Domain hierarchy](https://book.systemsapproach.org/_images/f09-15-9780123850591.png)

---

![Name server hierarchy](https://book.systemsapproach.org/_images/f09-17-9780123850591.png)

---

Name resolution
---------------

- Local nameserver is queried
- If it has the appropriate value cached, it returns it
- Otherwise, it queries the appropriate name server

---

![Name resolution process](https://book.systemsapproach.org/_images/f09-18-9780123850591.png){height=540px}

7.2 Multimedia Data
===================

Data Requirements
-----------------

- A modern 4k60 video stream will contain 3840*2160*24*60 = 11.94 gbps of data
- A 2k30 stream will still be over 1 gbps
- This amount of data is not serviceable by mainstream network technologies in use today
- Modern techniques can bring the bandwidth requirements for the stream down to ~30 mbps

Compression
-----------

- Use fewer bytes to transmit information
- Lossless compression - information is transmitted exactly
- Lossy compression - some information is lost

Run-length Encoding
-------------------

- Lossless compression
- Encodes runs of the same type
- AAABBCDDDD -> 3A2B1C4D

Dictionary Methods
------------------

- Lossless compression
- Replace words or phrases with references to words or phrases in a known dictionary

Image Compression
-----------------

- Subsampling
- Transforms - DCT, Wavelet, etc
- Quantization
- Encoding

Subsampling
-----------

- Humans are more perceptive to changes in color than brightness
- We can use more pixels for brightness than for color

---

![YUV Subsampling](https://book.systemsapproach.org/_images/f07-11-9780123850591.png)

JPEG Compression
----------------

- Subsampling
- DCT
- Quantization
- Encoding

---

![JPEG compression](https://book.systemsapproach.org/_images/f07-12-9780123850591.png)

Discrete Cosine Transform
-------------------------

- DCT
- Transforms an image from the 2d dimension to the spatial frequency dimension
- Small changes from one pixel to the next are low frequencies, large changes are high frequencies

Quantization
------------

- DCT is lossless and saves no space
- Quantization rounds the DCT values
- Many values become 0

Encoding
--------

- The order of the DCT values is chosen to maximize long runs of zeroes
- RLE is use on runs of zeroes
- Additional lossless compression is used on remaining values

---

![JPEG encoding pattern](https://book.systemsapproach.org/_images/f07-13-9780123850591.png)

Video Compression
-----------------

- Apply image compression techniques
- Take advantage of similarity between frames

MPEG Frame Types
----------------

- I-frame - Intrapicture, reference frame, depends on no other frames
- P-frame - Predicted, difference from previous I-frame
- B-frame - Bi-directional predicted, difference from surround I and P frames

---

![MPEG Frame Types](https://book.systemsapproach.org/_images/f07-14-9780123850591.png)

Macroblocks
-----------

- 8x8 YUV information is stored together in 16x16 macroblocks

---

![Macroblock](https://book.systemsapproach.org/_images/f07-15-9780123850591.png)

Representing Predicted Frames
-----------------------------

- 2d array of macroblocks
- Macroblocks include motion vectors to reference frame(s)
- Macroblocks are encoded a different from reference blocks
