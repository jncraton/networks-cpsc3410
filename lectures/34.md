Email
=====

---

![Email data flow](https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/SMTP-transfer-model.svg/640px-SMTP-transfer-model.svg.png)

Simple Mail Transfer Protocol (SMTP)
------------------------------------

- Port 25 (465 for TLS, 587 for STARTTLS)
- Defaults to no encryption
- Can be used without authentication

Example Usage
-------------

- `ncat --ssl smtp.gmail.com 465`
- `HELO gmail.com`
- `AUTH LOGIN` - prompts for base64 username and password
- `QUIT`

---

    S: 220 smtp.example.com ESMTP Postfix
    C: HELO relay.example.com
    S: 250 smtp.example.com, I am glad to meet you
    C: MAIL FROM:<bob@example.com>
    S: 250 Ok
    C: RCPT TO:<alice@example.com>
    S: 250 Ok
    C: RCPT TO:<theboss@example.com>
    S: 250 Ok
    C: DATA
    S: 354 End data with <CR><LF>.<CR><LF>
    C: From: "Bob Example" <bob@example.com>
    C: To: Alice Example <alice@example.com>
    C: Cc: theboss@example.com
    C: Date: Tue, 15 Jan 2008 16:02:43 -0500
    C: Subject: Test message
    C: 
    C: Hello Alice.
    C: This is a test message with 5 header fields and 4 lines in the message body.
    C: Your friend,
    C: Bob
    C: .
    S: 250 Ok: queued as 12345
    C: QUIT
    S: 221 Bye

Internet Message Format (RFC 5322)
----------------------------------

- Plain text format
- Header fields
- Blank line
- Message body

Header fields
-------------

- To
- From
- CC
- BCC
- Subject

Email message example
---------------------

    From: Brian Schultz <bschultz@anderson.edu>
    Date: Tue, 19 Nov 2019 09:12:31 -0500
    Subject: Donuts!
    To: Jennifer Coy <jjcoy@anderson.edu>, Chuck Koontz <koontzcb@anderson.edu>, 
    	Jonathan Craton <jlcraton@anderson.edu>, Jason Lowmiller <jwlowmiller@anderson.edu>
    
    
    Donuts!
    
    *Brian Schultz* |  Adjunct Professor  |  School of Science and Engineering
    
    Department of Computer Science
    
    
    
    Anderson University  |  1100 E. Fifth St, Anderson, IN 46012
    
    bschultz@anderson.edu
    
    www.anderson.edu

Transport Layer Security (TLS)
------------------------------

- Provides an encrypted connection much like a TCP socket
- Keys are created during handshake
- Identity of server may be verified using public key cryptography (certificate)

Python Example

World Wide Web
==============

Transport Layer Security
------------------------

- Provides an encrypted connection much like a TCP socket
- Keys are created during handshake
- Identity of server may be verified using public key cryptography (certificate)

QUIC and HTTP/3
---------------

- TLS and TCP both require handshakes
- These can be combined to reduce latency
- QUIC was proposed in 2012 to address this and has now been adopted as part of HTTP/3

---

![Typical TLS Connection](https://1fykyq3mdn5r21tpna3wkdyi-wpengine.netdna-ssl.com/wp-content/uploads/2019/05/image10.png)

---

![QUIC Stack](https://1fykyq3mdn5r21tpna3wkdyi-wpengine.netdna-ssl.com/wp-content/uploads/2019/05/image8-696x315.png)

---

QUIC Performance
----------------

- Can improve latency by 10-30%

