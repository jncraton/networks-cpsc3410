Email
=====

---

![Email data flow](https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/SMTP-transfer-model.svg/640px-SMTP-transfer-model.svg.png)

Simple Mail Transfer Protocol (SMTP)
------------------------------------

- Port 25 (465 for TLS, 587 for STARTTLS)
- Defaults to no encryption
- Can be used without authentication

Example Usage
-------------

- `ncat --ssl smtp.gmail.com 465`
- `HELO gmail.com`
- `AUTH LOGIN` - prompts for base64 username and password
- `QUIT`

---

    S: 220 smtp.example.com ESMTP Postfix
    C: HELO relay.example.com
    S: 250 smtp.example.com, I am glad to meet you
    C: MAIL FROM:<bob@example.com>
    S: 250 Ok
    C: RCPT TO:<alice@example.com>
    S: 250 Ok
    C: RCPT TO:<theboss@example.com>
    S: 250 Ok
    C: DATA
    S: 354 End data with <CR><LF>.<CR><LF>
    C: From: "Bob Example" <bob@example.com>
    C: To: Alice Example <alice@example.com>
    C: Cc: theboss@example.com
    C: Date: Tue, 15 Jan 2008 16:02:43 -0500
    C: Subject: Test message
    C: 
    C: Hello Alice.
    C: This is a test message with 5 header fields and 4 lines in the message body.
    C: Your friend,
    C: Bob
    C: .
    S: 250 Ok: queued as 12345
    C: QUIT
    S: 221 Bye

Internet Message Format (RFC 5322)
----------------------------------

- Plain text format
- Header fields
- Blank line
- Message body

Header fields
-------------

- To
- From
- CC
- BCC
- Subject

Email message example
---------------------

    From: Brian Schultz <bschultz@anderson.edu>
    Date: Tue, 19 Nov 2019 09:12:31 -0500
    Subject: Donuts!
    To: Jennifer Coy <jjcoy@anderson.edu>, Chuck Koontz <koontzcb@anderson.edu>, 
    	Jonathan Craton <jlcraton@anderson.edu>, Jason Lowmiller <jwlowmiller@anderson.edu>
    
    
    Donuts!
    
    *Brian Schultz* |  Adjunct Professor  |  School of Science and Engineering
    
    Department of Computer Science
    
    
    
    Anderson University  |  1100 E. Fifth St, Anderson, IN 46012
    
    bschultz@anderson.edu
    
    www.anderson.edu

Transport Layer Security (TLS)
------------------------------

- Provides an encrypted connection much like a TCP socket
- Keys are created during handshake
- Identity of server may be verified using public key cryptography (certificate)

TLS Example
-----------

- Listener: `ncat -l --ssl localhost 2002`
- Client: `ncat --ssl localhost 2002`

Internet Message Access Protocol (IMAP)
---------------------------------------

- Allows mail clients to retrieve mail from servers
- Uses port 143 (993 for TLS)
- Can download, delete, mark as read, etc

Email Spam
----------

- Emails are free to send, but take time to read, so are a negative externality from the perspective of an advertiser
- Messages can be sent by botnets of compromised computers
- Messages can be sent using comprimised account credentials

Naive Bayes Spam Filtering
--------------------------

- Treats messages as a "bag of words"
- Learns probabilities for tokens based on messages marked as spam
- Applies Bayes theorem to place messages in spam folder or delete them
- Considered to be "naive" because tokens are assumed to be independent events

Other anti-spam techniques
--------------------------

- DNS-based blacklists (DNSBL)
- URL filtering
- SPF, DKIM, and DMARC to prevent email spoofing
